{% extends 'base.html' %}

{% load static %}

{% block page %}
<section class="grow basis-full mx-4 mt-5 sm:mt-6 md:mx-5 md:mt-8 lg:mx-6 lg:mt-10 2xl:mx-8 2xl:mt-12">
    <h2>{{ view.model.verbose_name_plural | title }}</h2>
    <section class="my-3 sm:my-4 md:my-6 lg:my-8 xl:my-10 2xl:my-12 block md:flex space-y-2 sm:space-y-3 md:space-y-0 md:space-x-4 lg:space-x-6 xl:space-x-8 2xl:space-x-10 3xl:space-x-12 justify-between items-end">
        <p class="w-full md:w-auto md:shrink md:grow">{{ view.model.details }}</p>
        <a href="{% url create_route %}" class="btn primary space-x-2">
            <i class="fa-solid fa-plus"></i>
            <span>New</span>
        </a>
    </section> 
</section>
<section class="px-0.5 sm:px-1 md:px-2 lg:px-4 xl:px-6 2xl:px-8 3xl:px-10" x-data="{ showDelete: false, deletePK = '' }">
    <table>
        <thead>
            <tr>
                {% with obj=object_list.0 %}
                    {% if "name" in obj %}
                    <th class="text-left">NAME</th>
                    {% endif %}
                    {% if obj.model.__name__ == "Project" %}
                    <th class="text-left">DESCRIPTION</th>
                    {% endif %}
                    {% if "class_assoc" in obj %}
                    <th class="text-center">CLASS</th>
                    {% endif %}
                    {% if "module" in obj or "from_class" in obj %}
                    <th class="text-center">MODULE</th>
                    {% endif %}
                    {% if "projects" in obj or "module" in obj %}
                    <th class="text-left">PROJECTS</th>
                    {% endif %}
                    {% if "visibility" in obj %}
                    <th class="text-center">VISIBILITY</th>
                    {% endif %}
                    {% if "data_type" in obj %}
                    <th class="text-center">DATA TYPE</th>
                    {% endif %}
                    {% if "arguments" in obj %}
                    <th class="text-left">ARGUMENTS</th>
                    <th class="text-center">RETURN TYPE</th>
                    {% endif %}
                    {% if "from_class" in obj %}
                    <th class="text-center">FROM</th>
                    <th class="text-center">TO</th>
                    <th class="text-center">TYPE</th>
                    {% endif %}
                    <th class="text-left">ACTIONS</th>
                {% endwith %}
            </tr>
        </thead>
        <tbody>
            {% for obj in object_list %}
            <tr>
                {% if "name" in obj %}
                <td class="text-left">{{ obj.name }}</td>
                {% endif %}
                {% if obj.model.__name__ == "Project" %}
                <td class="text-left">{{ obj.description }}</td>
                {% endif %}
                {% if "class_assoc" in obj %}
                <td class="text-center">{{ obj.class_assoc.name }}</td>
                {% endif %}
                {% if "module" in obj or "from_class" in obj %}
                <td class="text-center">{% if "module" in obj %}{{ obj.module.name }}{% elif "from_class" in obj %}{{ obj.from_class.module.name }}{% endif %}</td>
                {% endif %}
                {% if "projects" in obj or "module" in obj %}
                <td class="text-left">
                    <ul class="list-disc list-outside ml-4">
                        {% if "projects" in obj %}
                            {% for project in obj.projects %}
                            <li>{{ project.name }}</li>
                            {% endfor %}
                        {% elif "module" in obj %}
                            {% for project in obj.module.projects %}
                            <li>{{ project.name }}</li>
                            {% endfor %}
                        {% endif %}
                    </ul>
                </td>
                {% endif %}
                {% if "visibility" in obj %}
                <td class="text-center">{{ obj.visibility }}</td>
                {% endif %}
                {% if "data_type" in obj %}
                <td class="text-center">{{ obj.data_type }}</td>
                {% endif %}
                {% if "arguments" in obj %}
                <td class="text-left">{{ obj.arguments }}</td>
                <td class="text-center">{{ obj.return_type }}</td>
                {% endif %}
                {% if "from_class" in obj %}
                <td class="text-center">{{ obj.from_class.name }}</td>
                <td class="text-center">{{ obj.to_class.name }}</td>
                <td class="text-center">{{ obj.relationship_type }}</td>
                {% endif %}
                <td>
                    <div class="w-full flex justify-between items-center space-x-2 md:space-x-3 xl:space-x-4">
                        <a href="{% url detail_route pk=obj.id %}" class="btn-square primary">
                            <i class="fa-solid fa-eye"></i>
                        </a>
                        <button class="btn-square red" @click="deletePK = '{{ obj.id }}'; showDelete = true">
                            <i class="fa-solid fa-trash-can"></i>
                        </button>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <div class="bg-slate-500/15 backdrop-blur-sm fixed inset-0 z-50" x-show="showDelete" @click.self="showDelete = false">
        <section class="absolute transition top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 shadow-lg dark:shadow-violet-800 border border-slate-300 dark:border-slate-600 z-[70]">
            <header class="p-2 md:p-4 xl:p-6 3xl:p-8 bg-blue-700 dark:bg-violet-700 text-slate-100 flex justify-between items-center space-x-2 sm:space-x-4 md:space-x-6 lg:space-x-8 xl:space-x-10 2xl:space-x-12">
                <h3>Delete</h3>
                <button class="h-6 w-6 md:h-8 md:w-8 lg:h-10 lg:w-10 xl:h-12 xl:w-12 rounded-full p-2 hover:bg-white/20" @click="showDelete = false">
                    <i class="fa-solid fa-x"></i>
                </button>
            </header>
            <form class="p-2 md:p-4 xl:p-6 3xl:p-8 mt-2 md:mt-4 xl:mt-6 space-y-3 md:space-y-5 xl:space-y-7" methd="post" x-init="() => {const action = `${window.location.pathname}?pk=${deletePK}`; $el.action = action}">
                {% csrf_token %}
                <p>Are you sure you want to delete this {{ view.model.__name__ }}? This action cannot be undone.</p>
                <div class="flex justify-between items-center space-x-2 md:space-x-4 xl:space-x-8">
                    <button class="btn primary" @click.prevent="showDelete = false">Cancel</button>
                    <button type="submit" class="btn red">Confirm</button>
                </div>
            </form>
        </section>
    </div>
</section>
{% endblock %}